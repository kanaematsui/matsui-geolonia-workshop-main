<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geolonia Maps Workshop</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Geolonia のスクリプト（埋め込み用）-->
  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=56ea3745456d47859d6aa3be9bc7aed9" defer></script>
</head>
<body>
  <h1>Geolonia Maps – Marker Workshop</h1>

  <!-- data-* 属性で基本設定 -->
  <div
    class="geolonia"
    data-lat="34.342"
    data-lng="134.046"
    data-zoom="13"
    data-style="geolonia/basic"
    style="width:100%;height:60vh;"
  >
    <a data-lat="34.342" data-lng="134.046"> 高松市</a>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const el = document.querySelector('.geolonia');

  el.addEventListener('geolonia.load', async (e) => {
    const map = e.detail.map;



    const res = await fetch('./data.geojson');
    const geojson = await res.json();

    // 各点に Marker を置く（シンプル版）
    for (const f of geojson.features) {
      const [lng, lat] = f.geometry.coordinates;
      const { name, desc } = f.properties;

      new maplibregl.Marker()
        .setLngLat([lng, lat])
        .setPopup(new maplibregl.Popup().setHTML(`<strong>${name}</strong><br>${desc ?? ''}`))
        .addTo(map);
    }

    // 画面内に全部入るようフィット
    const coords = geojson.features.map(f => f.geometry.coordinates);
    const bounds = coords.reduce((b, c) => b.extend(c), new maplibregl.LngLatBounds(coords[0], coords[0]));
    map.fitBounds(bounds, { padding: 40, duration: 500 });
  });
});
</script>
</body>
</html>
